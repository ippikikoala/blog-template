# ブログ改善TODO

このドキュメントは、ブログの改善点を管理するためのチェックリストです。
完了したタスクには ✅ をつけています。

---

## 1. フォントサイズの調整

- [x] `src/app/globals.css` の body font-size を 17px → 15px に変更
- [x] ビルドして表示確認

**優先度**: 高（簡単）
**ファイル**: `src/app/globals.css`
**ステータス**: ✅ 完了

---

## 2. 目次（TableOfContents）の修正

### 問題点
- 目次のリンクが見出しに飛ばない（ID不一致）
- 記事本文冒頭に旧目次リンクが残っている

### 対応
- [x] `github-slugger` パッケージをインストール
- [x] `src/app/posts/[slug]/page.tsx` でMDXコンポーネントにID付与
- [x] TableOfContents.tsx の ID生成ロジックを github-slugger に統一
- [x] ビルドして目次のリンクが正常に動作するか確認
- [x] Pythonスクリプトで本文冒頭の旧目次リンクを削除（47ファイル修正）

**優先度**: 高
**ファイル**:
- `src/app/posts/[slug]/page.tsx`
- `src/components/TableOfContents.tsx`
- `scripts/remove_old_toc.py`
- `content/posts/*.mdx` (47ファイル)
- `package.json`
**ステータス**: ✅ 完了

---

## 3. MDXファイルのクリーンアップ

### 問題点
- 本文冒頭に旧目次リンク `[見出し](#見出し)` が残っている
- descriptionフィールドに目次テキストが混入している
- Hatenaキーワードリンク `d.hatena.ne.jp` が残っている

### 対応
- [x] クリーンアップスクリプト作成（Python）
  - [x] 本文冒頭の目次リンク削除
  - [x] descriptionから目次テキスト除去
  - [x] Hatenaキーワードリンク `[テキスト](https://d.hatena.ne.jp/...)` をプレーンテキスト化
  - [x] description内の裸のHatena URL `(https://d.hatena.ne.jp/...)` を削除
  - [x] truncateされたHatena URL（末尾が`...`）にも対応
- [x] 全139記事に対してスクリプト実行（136ファイル修正）
- [x] ビルドして動作確認
- [x] 変更をコミット

**優先度**: 高
**対象**: `content/posts/*.mdx` (139ファイル)
**スクリプト**: `scripts/cleanup_mdx.py`
**ステータス**: ✅ 完了

---

## 4. タグの復元

### 問題点
- 移行時にタグ情報が失われ `tags: []` になっている

### 対応
- [x] 元のHatenaブログエクスポートデータを確認
- [x] タグ復元スクリプト作成 (`scripts/restore_tags.py`)
- [x] 全記事のfrontmatterにタグを追加（44ファイル更新）
- [x] 動作確認（タグページ、記事詳細ページ）

**優先度**: 中
**対象**: `content/posts/*.mdx`
**スクリプト**: `scripts/restore_tags.py`
**ステータス**: ✅ 完了

### 補足
- Hatenaブログエクスポートの`CATEGORY`フィールドを解析
- 最初のCATEGORYはcategory（既存）、2番目以降をtagsとして復元
- 44件のファイルにタグを追加（82件はタグなし記事）
- 復元されたタグ: 廃線(9), 炭鉱(8), IT(6), ロードバイク(6), 旅館(5), 島(4), 温泉(2), 機材(2), 他

---

## 5. iframe埋め込みの実装

### 問題点
- `[Google Maps埋め込み]` プレースホルダーのまま（14記事）
- YouTube埋め込みが欠落（77件）

### 対応
- [x] YouTube埋め込みコンポーネント作成（`src/components/embeds/YouTube.tsx`）
- [x] Google Maps埋め込みコンポーネント作成（`src/components/embeds/GoogleMap.tsx`）
- [x] MDXRemoteコンポーネント設定更新（`src/app/posts/[slug]/page.tsx`）
- [x] iframe情報抽出スクリプト作成（`scripts/extract_iframes.py`）
  - YouTube: 77件検出
  - Google Maps: 33件検出
  - 対象記事: 31件
- [x] 更新ガイド生成スクリプト作成（`scripts/update_mdx_iframes.py`）
- [x] 更新ガイド生成（`iframe_update_guide.md`）
- [x] 自動更新スクリプト作成（`scripts/auto_update_iframes.py`）
- [x] Google Maps自動更新実行（13記事、31件）
- [x] ビルド確認（エラーなし）
- [ ] YouTube埋め込み追加（77件、任意）
- [ ] 全埋め込みの表示確認（ブラウザ確認）

**優先度**: 高
**ステータス**: ✅ 完了（Google Maps埋め込み）

**実装完了ファイル**:
- `src/components/embeds/YouTube.tsx` - YouTubeコンポーネント
- `src/components/embeds/GoogleMap.tsx` - Google Mapsコンポーネント
- `src/app/posts/[slug]/page.tsx` - MDXRemote設定更新
- `scripts/extract_iframes.py` - iframe情報抽出スクリプト
- `scripts/update_mdx_iframes.py` - 更新ガイド生成スクリプト
- `scripts/auto_update_iframes.py` - 自動更新スクリプト
- `iframe_mapping.json` - 抽出結果
- `iframe_update_guide.md` - 手動更新用ガイド

**更新完了記事（14記事）**:
- 手動更新: 2025-12-28-174758.mdx（Google Maps 2件）
- 自動更新: 13記事（Google Maps 31件）
  - 2025-05-06-231710.mdx（5件）
  - 2025-05-18-185739.mdx（4件）
  - 2026-01-04-223535.mdx（4件）
  - 2025-11-04-230836.mdx（3件）
  - 2025-11-09-172638.mdx（3件）
  - 2025-12-21-171641.mdx（3件）
  - 2025-11-09-010007.mdx（2件）
  - 2026-01-04-185146.mdx（2件）
  - 2025-10-29-233946.mdx（1件）
  - 2025-11-04-235915.mdx（1件）
  - 2026-01-04-160039.mdx（1件）
  - 2026-01-04-160836.mdx（1件）
  - 2026-01-05-001743.mdx（1件）

**次のステップ（任意）**:
1. YouTube埋め込み追加（77件）
   - `iframe_update_guide.md` を参照
   - 手動で各記事に追加
2. 各記事を `npm run dev` で表示確認
3. YouTube動画の再生確認
4. Google Mapsの操作確認（ドラッグ、ズーム）
5. レスポンシブ表示確認

---

## 6. 目次に中見出し・小見出しが表示されない

### 問題点
- 目次（TableOfContents）にh2-h4しか表示されていなかった
- h5・h6が無視されていた（Hatenaブログでは全レベル表示されていた）

### 対応
- [x] `src/components/TableOfContents.tsx` の正規表現を`#{2,6}`に変更
- [x] `src/app/posts/[slug]/page.tsx` でh5/h6にもID付与
- [x] `src/app/globals.css` でh2-h6の階層的スタイリング実装
  - h2: 太字15px（インデントなし）
  - h3: 14px、16pxインデント
  - h4: 14px（インデントなし）
  - h5: 13px、16pxインデント
  - h6: 12px、32pxインデント
- [x] ビルドして動作確認（225ページ生成成功）

**優先度**: 高
**ファイル**:
- `src/components/TableOfContents.tsx`
- `src/app/posts/[slug]/page.tsx`
- `src/app/globals.css`
**ステータス**: ✅ 完了

---

## 7. スマホのハンバーガーメニューが機能しない

### 問題点
- スマホでハンバーガーメニューを押すと「Menu」というテキストしか表示されない
- カテゴリ一覧などのナビゲーションが表示されない

### 対応
- [x] `src/components/Header.tsx` のモバイルメニュー実装を確認
- [x] メニュー展開時にカテゴリ一覧を表示するよう修正
- [x] 必要に応じてSidebarコンポーネントとの連携を検討
- [x] 実機またはDevToolsのモバイル表示で動作確認

**優先度**: 高
**ファイル**:
- `src/components/Header.tsx` - サーバーコンポーネントに変更
- `src/components/MobileMenu.tsx` - 新規作成（クライアントコンポーネント）
**ステータス**: ✅ 完了

### 実装内容
- `Header.tsx`をサーバーコンポーネントに変更し、カテゴリ・タグデータをサーバーサイドで取得
- `MobileMenu.tsx`を新規作成し、モバイルメニューのインタラクティブ部分を分離
- モバイルメニューにカテゴリ一覧（上位10件）とタグ一覧（上位12件）を表示
- 各リンククリック時にメニューを自動的に閉じる動作を実装

---

## 8. スマホ版サイドバーのカテゴリ表示修正

### 問題点
- モバイル表示時にサイドバーのカテゴリが使いにくい

### 対応
- [x] スマホで実際の表示を確認
- [x] 問題箇所を特定
- [x] モバイルメニューにカテゴリ・タグを追加（#7で対応）
- [x] モバイルでの表示確認

**優先度**: 中
**ファイル**:
- `src/components/MobileMenu.tsx` - モバイル用カテゴリ・タグ表示を実装
**ステータス**: ✅ 完了

### 実装内容
- #7の対応でモバイルメニューにカテゴリ・タグを追加したことで解決
- サイドバーは大画面（lg以上）で表示、モバイルではハンバーガーメニューからアクセス

---

## 9. カテゴリの整理・並び順の変更

### 問題点
- カテゴリが「廃線」「炭鉱」「IT」など都道府県以外になっている記事がある
- カテゴリが空（""）の記事がある
- 一覧ページのカテゴリが記事数順で、地理的に探しにくい

### 対応
- [x] 非都道府県カテゴリ（廃線・炭鉱・IT・ロードバイク・機材・旅館・島・小山田壮平）を調査
- [x] 各記事の内容から正しい都道府県カテゴリを特定
- [x] 空カテゴリの記事を調査・分類
- [x] 修正スクリプト作成（`scripts/fix_categories.py`）
- [x] 52件のMDXファイルのcategoryを修正
- [x] 元のカテゴリ（廃線・炭鉱等）はタグとして保持
- [x] `src/lib/posts.ts` の `getAllCategories()` を北から南順（JISコード順）にソート
- [x] ビルド確認

**優先度**: 高
**ファイル**:
- `scripts/fix_categories.py` - カテゴリ修正スクリプト
- `src/lib/posts.ts` - カテゴリソート順の変更
- `content/posts/*.mdx` (52ファイル)
**ステータス**: ✅ 完了

### 修正内容サマリー
- **廃線カテゴリ（7件）**: 北海道(2), 岐阜県(1), 和歌山県(2), 宮崎県(2)
- **炭鉱カテゴリ（7件）**: 北海道(6), 福島県(1)
- **ITカテゴリ（9件）**: その他(9)
- **ロードバイクカテゴリ（6件）**: 徳島県(2), 高知県(2), 千葉県(1), 愛媛県(1)
- **機材カテゴリ（4件）**: 福島県(1), 東京都(1), その他(2)
- **旅館カテゴリ（4件）**: 北海道(1), 長崎県(1), 愛知県(1), 新潟県(1)
- **島カテゴリ（3件）**: 滋賀県(2), 兵庫県(1)
- **小山田壮平カテゴリ（1件）**: 愛知県(1)
- **空カテゴリ（11件）**: 奈良県(1), 愛媛県(1), 山形県(1), 長野県(1), その他(7)

---

## 10. スマホ版UIの改善

### 問題点
- **問題1**: トップページ（記事一覧）で目次の内容が表示されてしまう
- **問題2**: ハンバーガーメニューを押しても何も表示されない（実機iPhone/Androidで確認）
- **問題3**: 記事カード（一覧）に都道府県カテゴリバッジが表示されていない

### 対応

#### 問題1: 目次の誤表示
- [ ] 目次が記事詳細ページ以外に表示されないことを確認
- [ ] 必要に応じてトップページのレンダリングロジックを調査
- [ ] 一覧画面で目次コンポーネントが呼ばれていないか確認

**原因仮説**:
- TableOfContentsは記事詳細ページ（`src/app/posts/[slug]/page.tsx`）でのみ使用されている
- トップページ（`src/app/page.tsx`）では使用されていない
- 別の原因（キャッシュ、ビルド成果物の問題等）の可能性あり

#### 問題2: ハンバーガーメニューが開かない → **解決済み**
- [x] `src/components/MobileMenu.tsx` のz-index設定を確認・修正
- [x] React Portalを使ってbody直下にレンダリングする実装
- [x] 実機での動作確認（iPhone/Android）

**解決方法**: React Portalでbody直下にレンダリング + z-index調整

#### 問題2-b: カテゴリ/タグリンクをクリックすると404エラー → **解決済み**
- [x] `generateStaticParams`から`encodeURIComponent`を削除
- [x] Next.js App Routerが自動的にURLエンコーディングを処理

**原因**: `generateStaticParams`で`encodeURIComponent`を使用していたため、Next.jsの自動エンコーディングと競合していた

**修正ファイル**:
- `src/app/categories/[category]/page.tsx`
- `src/app/tags/[tag]/page.tsx`

#### 問題3: カテゴリバッジの表示改善
- [ ] `src/components/PostCard.tsx` のカテゴリバッジフォントサイズを確認
  - 現状: `text-[10px]` (非常に小さい)
- [ ] モバイルでのフォントサイズを調整（最低12px推奨）
- [ ] レスポンシブクラスを追加（`text-[10px] sm:text-xs`）
- [ ] 実機での視認性確認

**実装済み箇所**:
- カテゴリバッジ自体は実装済み（[PostCard.tsx:36-45](src/components/PostCard.tsx#L36-L45)）
- `normalizeCategory()` で複数カテゴリ対応済み

**優先度**: 高
**ファイル**:
- `src/app/page.tsx` - トップページ（問題1の調査）
- `src/components/MobileMenu.tsx` - ハンバーガーメニュー（解決済み）
- `src/app/globals.css` - z-index設定（解決済み）
- `src/app/categories/[category]/page.tsx` - カテゴリページ（解決済み）
- `src/app/tags/[tag]/page.tsx` - タグページ（解決済み）
- `src/components/PostCard.tsx` - カテゴリバッジ
**ステータス**: 一部解決（問題2, 2-b完了 / 問題1, 3未着手）

---

## 11. スマホでの横スクロール問題

### 問題点
- スマホで一覧ページを縦スクロールすると画面が左右にぶれる
- 横スクロールが可能になっていて操作性が悪い

### 対応
- [x] `src/app/globals.css` で `html, body` に `overflow-x: hidden` を追加
- [x] 実機で動作確認
- [x] 本番環境にデプロイ

**優先度**: 高
**ファイル**: `src/app/globals.css`
**ステータス**: ✅ 完了

---

## 12. カテゴリーを増やしたい

### 問題点
- 現在のカテゴリは都道府県のみ
- テーマ別カテゴリ（温泉、廃線、炭鉱など）も追加したい
- **具体的な要件**:
  - カテゴリが「その他」かつタグに「IT」がある記事 → 「IT」カテゴリに変更したい（9件）
  - カテゴリが「愛知県」かつタグに「小山田壮平」がある記事 → 「小山田壮平」カテゴリに変更したい（1件）

### 対応
- [ ] 新規カテゴリの追加
  - [ ] 「IT」カテゴリを追加（カテゴリが「その他」でタグに「IT」を含む記事を移行）
  - [ ] 「小山田壮平」カテゴリを追加（カテゴリが「愛知県」でタグに「小山田壮平」を含む記事を移行）
- [ ] カテゴリ移行スクリプト作成
  - [ ] その他 + IT タグ → IT カテゴリ（9件）
  - [ ] 愛知県 + 小山田壮平タグ → 小山田壮平カテゴリ（1件）
- [ ] カテゴリ構造の設計（都道府県 + テーマ別の共存方法）
- [ ] `src/lib/posts.ts` のカテゴリソート順更新（都道府県とテーマ別の表示順）
- [ ] UIへの反映（サイドバー、ハンバーガーメニュー）
- [ ] ビルド & 動作確認

**優先度**: 中
**ファイル**:
- `src/lib/posts.ts` - カテゴリ管理ロジック
- `content/posts/*.mdx` - 記事のカテゴリフィールド（10ファイル）
- `scripts/add_new_categories.py` - カテゴリ追加スクリプト（新規作成）
- `src/components/Sidebar.tsx` - サイドバー表示
- `src/components/MobileMenu.tsx` - モバイルメニュー表示
**ステータス**: 未着手

### 対象記事
- **ITカテゴリ候補（9件）**: カテゴリ「その他」、タグ「IT」
- **小山田壮平カテゴリ候補（1件）**: カテゴリ「愛知県」、タグ「小山田壮平」

---

## 13. 記事詳細でのPart1などのブログ参照リンクが消えているので復活させたい

### 問題点
- 記事内で他の記事を参照する「Part1」「続き」などのリンクが失われている
- Hatenaブログからの移行時に内部リンクが削除された可能性

### 対応
- [x] 元のHatenaブログエクスポートデータから内部リンクを抽出
- [x] 現在のMDXファイルとの差分確認
- [x] 内部リンク復元スクリプト作成
- [x] リンク先のslugマッピング作成（Hatena URL → Next.js slug）
- [x] 復元実行 & 動作確認

**優先度**: 中
**ファイル**:
- `content/posts/*.mdx` - 記事本文のリンク（22ファイル修正）
- `scripts/restore_internal_links.py` - 復元スクリプト（新規作成）
**ステータス**: ✅ 完了（26件のリンクを復活）

---

## 14. 記事詳細での見出しが本文と同じフォントになっている場合があるので直したい

### 問題点
- 記事詳細ページで見出し（h2-h6）が本文と区別しにくい
- フォントサイズ・太さが適切でない箇所がある

### 対応
- [x] 現在のスタイル定義を確認（`src/app/globals.css`）
- [x] 見出しレベル別のフォントサイズ・太さを再設定
- [x] Hatenaブログのスタイルと比較
- [x] 複数記事で表示確認
- [x] レスポンシブ対応確認（モバイル/デスクトップ）

**優先度**: 中
**ファイル**:
- `src/app/globals.css` - 見出しスタイル定義
- `src/app/posts/[slug]/page.tsx` - 記事詳細ページ
**ステータス**: ✅ 完了

---

## 15. そろそろ手動での新規記事投稿に向けて計画を作りたい

### 問題点
- 現在は移行した記事のみで、新規投稿フローが未確立
- GitHub Mobileでの編集を想定しているが、手順が明確でない

### 対応
- [ ] 新規記事作成の手順書作成
  - [ ] ファイル命名規則（YYYY-MM-DD-slug.mdx）
  - [ ] frontmatter必須フィールド
  - [ ] 画像アップロードフロー（Cloudflare R2）
  - [ ] カテゴリ・タグの選び方
- [ ] テンプレートファイル作成（`templates/new-post.mdx`）
- [ ] GitHub Mobileでの投稿手順確認
- [ ] 画像最適化スクリプト作成（リサイズ、WebP変換）
- [ ] プレビュー環境でのテスト投稿

**優先度**: 高
**ファイル**:
- `docs/10-new-post-guide.md` - 投稿手順書（新規作成）
- `templates/new-post.mdx` - テンプレート（新規作成）
- `scripts/optimize_images.py` - 画像最適化スクリプト（新規作成）
**ステータス**: 未着手

---

## 16. 手動での既存記事修正に向けて計画を建てたい

### 問題点
- 既存記事の修正フローが未確立
- タイポ修正、情報追加、画像差し替えなどの手順が不明確

### 対応
- [ ] 既存記事修正の手順書作成
  - [ ] GitHubでのファイル検索方法
  - [ ] frontmatter編集時の注意点
  - [ ] 画像URLの変更方法
  - [ ] プレビュー確認手順
- [ ] GitHub Mobileでの編集手順確認
- [ ] 変更前後の差分確認方法（git diff）
- [ ] ビルドエラー発生時の対処法
- [ ] テスト修正の実施（数記事）

**優先度**: 中
**ファイル**:
- `docs/11-edit-post-guide.md` - 修正手順書（新規作成）
**ステータス**: 未着手

---

## 17. テストページを削除

### 問題点
- ~~テスト用のページが残っている可能性がある~~
- ~~本番環境に不要なページが公開されている~~

### 対応
- [x] テストページの一覧確認
- [x] 不要なページファイルを特定
- [x] テストページの削除
- [x] ビルド確認

**削除したファイル**:
- `content/posts/sample-post.mdx` - サンプル記事
- `content/posts/hello-world.mdx` - Hello Worldテスト記事

**ステータス**: ✅ 完了

---

## 18. ブログのコアラの画像をオリジナルのものに更新

### 問題点
- 現在のコアラ画像がプレースホルダーまたは仮の画像
- オリジナルのコアラ画像に差し替える必要がある

### 対応
- [ ] 現在使用中のコアラ画像を確認
- [ ] オリジナルのコアラ画像を準備
- [ ] 画像の最適化（サイズ、WebP変換）
- [ ] Cloudflare R2にアップロード
- [ ] 画像URLを更新
- [ ] 各ページでの表示確認（サイドバー、ヘッダー等）

**優先度**: 中
**ファイル**:
- `src/components/Sidebar.tsx` - プロフィール画像
- `public/` - 画像ファイル
- Cloudflare R2 - 画像ストレージ
**ステータス**: 未着手

---

## 19. ページ最下部の「タグ」表記を英語に変更

### 問題点
- ページ最下部のタグセクションで「タグ」とカタカナ表記になっている
- 英語表記「Tags」に統一したい

### 対応
- [x] フッター内のタグセクションを確認
- [x] 「タグ」→「Tags」に変更
- [x] 他の日本語表記との整合性を確認（Home, About, Categories, RSS Feedと統一）
- [x] デスクトップ/モバイルでの表示確認

**優先度**: 低
**ファイル**:
- `src/components/Footer.tsx` - フッターコンポーネント（55行目）
**ステータス**: 完了

---

## 20. その他の改善（オプション）

- [ ] favicon追加 (`public/favicon.ico`)
- [ ] OGP画像作成 (`public/og-image.png`)
- [ ] Vercel Analytics有効化
- [ ] 検索機能追加（将来的に）

---

## 21. 画像のMarkdown構文エラー修正

### 問題点
- 複数の記事で画像のMarkdown構文が間違っている
- 誤った構文: `!テキスト[続き](URL)` → 画像が表示されず「!テキスト」とリンクが表示される
- 正しい構文: `![テキスト続き](URL)`

### 対応
- [x] 全MDXファイルをスキャンして誤った構文のパターンを検出
- [x] 修正スクリプト作成（`scripts/fix_image_markdown.py`）
- [x] 全ファイルに対してスクリプト実行（82ファイル、176件修正）
- [x] 修正後のビルド確認
- [x] 各記事で画像が正しく表示されることを確認

**優先度**: 高
**ファイル**:
- `content/posts/*.mdx` - 対象記事（82ファイル修正）
- `scripts/fix_image_markdown.py` - 修正スクリプト（新規作成）
**ステータス**: ✅ 完了

---

## 進捗管理

- **完了**: 14/21（#1-9, #11, #13, #14, #17, #19, #21）
- **進行中**: 0/21
- **未着手**: 7/21（#10一部, #12, #15-16, #18, #20）

---

## メモ

- 各タスク完了後はビルド & 動作確認を実施
- 重要な変更後はgitコミット
- 本番反映前にプレビュー環境で確認
- スマホ実機での確認を優先（DevToolsだけでは再現しない問題あり）

---

最終更新: 2026-01-11
