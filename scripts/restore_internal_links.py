#!/usr/bin/env python3
"""
#13: å†…éƒ¨ãƒªãƒ³ã‚¯ã‚’è‡ªå‹•å¾©æ´»ã•ã›ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

Hatenaã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‹ã‚‰å†…éƒ¨ãƒªãƒ³ã‚¯ã‚’æŠ½å‡ºã—ã€
ç¾åœ¨ã®MDXãƒ•ã‚¡ã‚¤ãƒ«ã®ã€ŒPart1ï¼šã€ç­‰ã®è¡Œã«ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã™ã‚‹ã€‚
"""

import re
from pathlib import Path

# æ‰‹å‹•ã§ä½œæˆã—ãŸãƒãƒƒãƒ”ãƒ³ã‚°
# MDXãƒ•ã‚¡ã‚¤ãƒ«å: [(è¡Œãƒ‘ã‚¿ãƒ¼ãƒ³, ãƒªãƒ³ã‚¯å…ˆslug), ...]
LINK_MAPPINGS = {
    "2024-01-07-2024-01-08-173421.mdx": [
        ("Part1ã¯ã“ã¡ã‚‰", "2024-01-07-2024-01-07-143705"),  # ä½ç”°å²¬ Part1
    ],
    "2024-11-03-2024-11-03-235919.mdx": [
        ("Part2ã¯ã“ã¡ã‚‰ï¼š", "2024-11-04-2024-11-04-231718"),  # ç¾…è‡¼
    ],
    "2024-11-04-2024-11-04-231718.mdx": [
        ("Part1ã¯ã“ã¡ã‚‰ï¼š", "2024-11-03-2024-11-03-235919"),  # çŸ¥åºŠ
    ],
    "2024-11-08-2024-11-08-230855.mdx": [
        ("Part1ï¼š", "2024-11-03-2024-11-03-235919"),
        ("Part2ï¼š", "2024-11-04-2024-11-04-231718"),
    ],
    "2024-11-10-2024-11-10-205802.mdx": [
        ("Part1ï¼š", "2024-11-03-2024-11-03-235919"),
        ("Part2ï¼š", "2024-11-04-2024-11-04-231718"),
        ("Part3ï¼š", "2024-11-08-2024-11-08-230855"),
    ],
    "2024-11-24-2024-11-24-204346.mdx": [
        ("Part5ï¼š", "2024-11-10-2024-11-10-205802"),
    ],
    "2025-02-25-2025-02-25-234017.mdx": [
        ("Part1ï¼š", "2025-02-24-2025-02-24-232907"),  # äºŒæœ¬æ¾ Part1
    ],
    "2025-05-04-2025-05-04-175959.mdx": [
        ("Part3ã¸ï¼š", "2025-05-06-2025-05-06-155358"),
    ],
    "2025-05-06-2025-05-06-155358.mdx": [
        ("Part4ã¸ï¼š", "2025-05-06-2025-05-06-231710"),
    ],
    "2025-05-08-2025-05-08-204737.mdx": [
        ("Part5ï¼š", "2025-05-10-2025-05-10-223616"),
    ],
    "2025-05-10-2025-05-10-223616.mdx": [
        ("ç¶šãã¯ã“ã¡ã‚‰", "2025-05-11-2025-05-11-184211"),
    ],
    "2025-06-16-2025-06-16-235222.mdx": [
        ("Part2ã¸", "2025-06-17-2025-06-17-232724"),
    ],
    "2025-07-27-2025-07-27-205234.mdx": [
        ("Part1ï¼š", "2025-07-27-2025-07-27-200024"),
        ("Part3ï¼š", "2025-08-03-2025-08-03-172757"),
    ],
    "2025-08-03-2025-08-03-172757.mdx": [
        ("Part1ï¼š", "2025-07-27-2025-07-27-200024"),
    ],
    "2025-08-23-2025-08-23-233545.mdx": [
        ("Part2ã¸ï¼š", "2025-08-24-2025-08-24-210100"),
    ],
    "2025-08-24-2025-08-24-210100.mdx": [
        ("Part1ï¼š", "2025-08-23-2025-08-23-233545"),
    ],
    "2025-09-22-2025-09-22-234621.mdx": [
        ("Part2ã¸", "2025-09-23-2025-09-23-224149"),
    ],
    "2025-09-23-2025-09-23-224149.mdx": [
        ("Part1ã¯ã“ã¡ã‚‰ï¼š", "2025-09-22-2025-09-22-234621"),
    ],
    "2025-11-04-2025-11-04-230836.mdx": [
        ("ã®ç¶šã", "2025-10-29-2025-10-29-233946"),
    ],
    "2025-12-21-2025-12-21-221314.mdx": [
        ("Part1ã¯ã“ã¡ã‚‰ï¼š", "2025-12-21-2025-12-21-171641"),
    ],
    "2026-01-04-2026-01-04-160836.mdx": [
        ("Part1ã¯ã“ã¡ã‚‰ï¼š", "2024-01-05-2024-01-05-120927"),  # å¤§åˆ¥è‹…
    ],
    "2026-01-04-2026-01-04-185146.mdx": [
        ("Part4ã¸ï¼š", "2026-01-04-2026-01-04-223535"),
    ],
}


def apply_fixes():
    """ãƒãƒƒãƒ”ãƒ³ã‚°ã«åŸºã¥ã„ã¦ãƒªãƒ³ã‚¯ã‚’è¿½åŠ """
    posts_dir = Path(__file__).parent.parent / 'content' / 'posts'
    
    print("=" * 60)
    print("å†…éƒ¨ãƒªãƒ³ã‚¯å¾©æ´»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (#13) - è‡ªå‹•ä¿®æ­£")
    print("=" * 60)
    print()
    
    total_fixes = 0
    files_modified = 0
    
    for filename, mappings in LINK_MAPPINGS.items():
        file_path = posts_dir / filename
        
        if not file_path.exists():
            print(f"âš ï¸  ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {filename}")
            continue
        
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        original_content = content
        file_fixes = 0
        
        for pattern, target_slug in mappings:
            # ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å®Œå…¨ä¸€è‡´ã™ã‚‹è¡Œã‚’æ¢ã™
            # è¡Œæœ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢ï¼ˆãƒªãƒ³ã‚¯ãŒã¾ã ãªã„å ´åˆã®ã¿ï¼‰
            escaped_pattern = re.escape(pattern)
            regex = rf'^({escaped_pattern})\s*$'
            
            def replace_func(match):
                nonlocal file_fixes
                file_fixes += 1
                return f'{match.group(1)} [è¨˜äº‹ã‚’è¦‹ã‚‹](/posts/{target_slug})'
            
            content = re.sub(regex, replace_func, content, flags=re.MULTILINE)
        
        if content != original_content:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)
            
            files_modified += 1
            total_fixes += file_fixes
            print(f"ğŸ“ {filename}: {file_fixes}ä»¶ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ")
            for pattern, target_slug in mappings:
                print(f"   {pattern} â†’ /posts/{target_slug}")
    
    print()
    print("=" * 60)
    print(f"å®Œäº†: {files_modified}ãƒ•ã‚¡ã‚¤ãƒ«ã€{total_fixes}ä»¶ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã—ã¾ã—ãŸ")
    print("=" * 60)


if __name__ == '__main__':
    apply_fixes()
